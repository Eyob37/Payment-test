<!DOCTYPE html>
<html>
<body>
    <h2>Simple Google Drive Access</h2>
    <button onclick="authenticate()">Connect to Google Drive</button>
    <div id="output"></div>

    <script>
        // Step 1: Configure your app in Google Cloud Console
        const CLIENT_ID = "789202929495-8ga0rfnv1m9ea0g4p48lmfvraa739aa8.apps.googleusercontent.com";
const API_KEY = "AIzaSyC2HJNSHQbJ6b3hpmborEq1tnxmj8BsQ30";

        
        // Use your actual domain or localhost for testing
        const REDIRECT_URI = window.location.origin + window.location.pathname;
        
        // Drive API scope
        const SCOPE = 'https://www.googleapis.com/auth/drive.readonly';
        
        // Generate OAuth URL
        function getOAuthURL() {
            const params = new URLSearchParams({
                client_id: CLIENT_ID,
                redirect_uri: REDIRECT_URI,
                response_type: 'token',  // Implicit flow for frontend
                scope: SCOPE,
                include_granted_scopes: 'true',
                state: 'pass-through-value'
            });
            
            return `https://accounts.google.com/o/oauth2/v2/auth?${params}`;
        }
        
        // Handle OAuth flow
        function authenticate() {
            // Store current URL to return to
            sessionStorage.setItem('preAuthUrl', window.location.href);
            
            // Redirect to Google OAuth
            window.location.href = getOAuthURL();
        }
        
        // Check for access token in URL fragment
        function checkForAccessToken() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            
            const accessToken = params.get('access_token');
            const error = params.get('error');
            
            if (accessToken) {
                // Success! Use the access token
                document.getElementById('output').innerHTML = 
                    '<p>Authentication successful!</p>' +
                    '<p>Access Token: ' + accessToken.substring(0, 20) + '...</p>';
                
                // Use the access token to call Drive API
                fetchDriveFiles(accessToken);
                
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
            } else if (error) {
                document.getElementById('output').innerHTML = 
                    `<p>Error: ${error}</p><p>${params.get('error_description')}</p>`;
            }
        }
        
        // Fetch files using access token
        async function fetchDriveFiles(accessToken) {
            try {
                const response = await fetch(
                    'https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name)',
                    {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    }
                );
                
                const data = await response.json();
                let html = '<h3>Your Files:</h3><ul>';
                
                data.files.forEach(file => {
                    html += `<li>${file.name}</li>`;
                });
                
                html += '</ul>';
                document.getElementById('output').innerHTML += html;
                
            } catch (error) {
                console.error('Error fetching files:', error);
            }
        }
        
        // Run on page load
        window.onload = checkForAccessToken;
    </script>
</body>
</html>