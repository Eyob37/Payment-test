<!DOCTYPE html>
<html>
<head>
    <title>Google Drive API - Frontend Only</title>
    <!-- Load Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Load Google API Client -->
    <script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
    <h2>Google Drive API Example</h2>
    
    <!-- Google Sign In Button -->
    <div id="g_id_onload"
         data-client_id="YOUR_CLIENT_ID.apps.googleusercontent.com"
         data-login_uri="http://localhost:8080"  <!-- Your actual domain -->
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>
    
    <button onclick="loadDriveAPI()" style="display:none;" id="driveBtn">
        Load Drive API
    </button>
    
    <div id="result"></div>

    <script>
        // Replace with your actual CLIENT_ID
        const CLIENT_ID = "789202929495-8ga0rfnv1m9ea0g4p48lmfvraa739aa8.apps.googleusercontent.com";
const API_KEY = "AIzaSyC2HJNSHQbJ6b3hpmborEq1tnxmj8BsQ30";

        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly';
        
        let tokenClient;
        let accessToken = '';
        
        // Initialize Google Sign-In
        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);
            document.getElementById('driveBtn').style.display = 'block';
        }
        
        // Load and initialize the Drive API
        function loadDriveAPI() {
            gapi.load('client', async () => {
                try {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                    });
                    
                    // Initialize OAuth2 client for token requests
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: (tokenResponse) => {
                            accessToken = tokenResponse.access_token;
                            listDriveFiles();
                        },
                    });
                    
                    // Request access token
                    tokenClient.requestAccessToken();
                    
                } catch (error) {
                    console.error('Error loading API:', error);
                    document.getElementById('result').innerHTML = 
                        'Error: ' + error.message;
                }
            });
        }
        
        // List files from Google Drive
        async function listDriveFiles() {
            try {
                const response = await gapi.client.drive.files.list({
                    'pageSize': 10,
                    'fields': 'files(id, name, mimeType, webViewLink)'
                });
                
                const files = response.result.files;
                let html = '<h3>Your Drive Files:</h3><ul>';
                
                if (files && files.length > 0) {
                    files.forEach((file) => {
                        html += `<li><strong>${file.name}</strong> (${file.mimeType})</li>`;
                    });
                } else {
                    html += '<li>No files found.</li>';
                }
                
                html += '</ul>';
                document.getElementById('result').innerHTML = html;
                
            } catch (error) {
                console.error('Error listing files:', error);
                document.getElementById('result').innerHTML = 
                    'Error listing files: ' + error.result.error.message;
            }
        }
        
        // You can also create a simple upload function
        async function uploadFile() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                const metadata = {
                    name: file.name,
                    mimeType: file.type
                };
                
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
                form.append('file', file);
                
                try {
                    const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + accessToken
                        },
                        body: form
                    });
                    
                    const result = await response.json();
                    console.log('File uploaded:', result);
                    alert('File uploaded successfully!');
                    
                } catch (error) {
                    console.error('Upload error:', error);
                }
            };
            
            fileInput.click();
        }
    </script>
    
    <div style="margin-top: 20px;">
        <button onclick="uploadFile()">Upload File to Drive</button>
    </div>
</body>
</html>